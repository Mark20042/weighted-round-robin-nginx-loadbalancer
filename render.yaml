services:
  # --- API Node 1 ---
  - type: web
    name: api-node-1
    env: node
    region: singapore
    plan: free
    buildCommand: npm install
    startCommand: node app.js
    envVars:
      - key: SERVER_NAME
        value: "API Server 1"
      - key: PORT
        value: 3000

  # --- API Node 2 ---
  - type: web
    name: api-node-2
    env: node
    region: singapore
    plan: free
    buildCommand: npm install
    startCommand: node app.js
    envVars:
      - key: SERVER_NAME
        value: "API Server 2"
      - key: PORT
        value: 3000

  # --- API Node 3 ---
  - type: web
    name: api-node-3
    env: node
    region: singapore
    plan: free
    buildCommand: npm install
    startCommand: node app.js
    envVars:
      - key: SERVER_NAME
        value: "API Server 3"
      - key: PORT
        value: 3000

  # --- API Node 4 ---
  - type: web
    name: api-node-4
    env: node
    region: singapore
    plan: free
    buildCommand: npm install
    startCommand: node app.js
    envVars:
      - key: SERVER_NAME
        value: "API Server 4"
      - key: PORT
        value: 3000

  # --- API Node 5 ---
  - type: web
    name: api-node-5
    env: node
    region: singapore
    plan: free
    buildCommand: npm install
    startCommand: node app.js
    envVars:
      - key: SERVER_NAME
        value: "API Server 5"
      - key: PORT
        value: 3000

  # --- Nginx Load Balancer ---
  - type: web
    name: nginx-lb
    env: docker
    region: singapore
    plan: free
    dockerContext: ./nginx
    dockerfilePath: ./nginx/Dockerfile
    healthCheckPath: /health
    envVars:
      # Hardcoded public URLs (Free Tier doesn't support internal networking)
      # These URLs are determined after initial deployment
      - key: API_1_ADDR
        value: api-node-1-ykwq.onrender.com
      - key: API_2_ADDR
        value: api-node-2-ms2c.onrender.com
      - key: API_3_ADDR
        value: api-node-3-27wd.onrender.com
      - key: API_4_ADDR
        value: api-node-4-q8mv.onrender.com
      - key: API_5_ADDR
        value: api-node-5-je7r.onrender.com

  # --- Frontend Client ---
  - type: web
    name: client-ui
    env: static
    buildCommand: npm install && npm run build
    staticPublishPath: dist
    rootDir: client
    envVars:
      - key: VITE_API_ORIGIN
        value: https://nginx-lb-j0am.onrender.com
